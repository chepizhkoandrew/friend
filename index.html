<script>
  let tasks = [];
  let lastTask = null; // Variable to store the last selected task

  // Fetch tasks from JSON file
  fetch('tasks.json')
      .then(response => response.json())
      .then(data => {
          tasks = data;
          console.log("Tasks loaded successfully:", tasks);
      })
      .catch(error => console.error('Error loading tasks:', error));

  function getRandomTask() {
      if (tasks.length === 0) {
          alert("Tasks are not loaded yet. Please try again.");
          return;
      }

      let weightedTasks = [];
      tasks.forEach(task => {
          let weight = Math.round(task.probability / 100 * 10); // Adjust weight scaling
          for (let i = 0; i < weight; i++) {
              weightedTasks.push(task);
          }
      });

      let randomTask;
      do {
          randomTask = weightedTasks[Math.floor(Math.random() * weightedTasks.length)];
      } while (lastTask && randomTask.name === lastTask.name);

      lastTask = randomTask; // Update lastTask with the new selection
      document.getElementById('task').innerText = randomTask.name;
      
      const taskImage = document.getElementById('taskImage');
      taskImage.src = 'images/' + randomTask.image;
      taskImage.style.display = 'block';

      // Add error handling for image loading
      taskImage.onerror = function() {
          console.error(`Failed to load image: ${taskImage.src}`);
          taskImage.style.display = 'none'; // Hide image if it can't be loaded
          document.getElementById('task').innerText = `Failed to load image for "${randomTask.name}". Check that "images/${randomTask.image}" exists.`;
      };
  }

  document.getElementById('getBusyButton').addEventListener('click', getRandomTask);
</script>